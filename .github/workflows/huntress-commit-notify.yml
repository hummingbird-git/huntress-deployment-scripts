name: Check new upstream commits

on:
  workflow_dispatch: # This allows you to manually trigger the workflow
  push:
  repository_dispatch:
    types: [check_upstream]

jobs:
  check_upstream_commits:
    runs-on: ubuntu-latest
    name: Check upstream latest commits

    steps:
    - name: Checkout main
      uses: actions/checkout@v2

    - name: Fetch upstream changes
      id: sync
      uses: ivanmilov/upstream_check_new_commits@v1
      with:
        upstream_repository: huntresslabs/deployment-scripts
        upstream_branch: master
        target_branch: springpoint/huntress-deployment-scripts
        
    - name: Send Email Notification     
      if: ${{ steps.sync.outputs.has_new_commits == 'true' }}
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.office365.com
        server_port: 587
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: New Commit in ${{ github.repository }}
        body: 'A new commit has been pushed. Check it out at ${{ github.event.compare }}'
        to: ${{ secrets.EMAIL_USERNAME }}
        from: ${{ secrets.EMAIL_USERNAME }}

